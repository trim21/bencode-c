# bencode-c

bencode serialize/deserialize written in native c extension.

```shell
pip install bencode-c
```

```python
import bencode_c

# NOTICE: we decode bencode bytes to bytes, not str.
assert bencode_c.bdecode(b'd5:hello5:worlde') == {b'hello': b'world'}

assert bencode_c.bencode(...) == b'...'
```

## Benchmark

this maybe the fastest bencode library in python.

compared packages:

- `abi3`: native c extension (this package) [bencode-c](https://pypi.org/project/bencode-c)
- `py`: pure python implement [bencode-py](https://pypi.org/project/bencode-py)
- `cy`: cython implement [fast-bencode](https://pypi.org/project/fast-bencode)
- `mypy`: pure python implement with mypyc [bencode2](https://pypi.org/project/bencode2)

test cases are 20 torrents from real world.

(windows, python3.10 AMD R7 5800X)

### Decode

```
-------------------------------------------------------------------------- benchmark 'case=decode': 4 tests --------------------------------------------------------------------------
Name (time in us)                    Median                    Min                    Max                   Mean              StdDev                 OPS            Rounds  Iterations
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark[decode-abi3]      1,031.7859 (1.0)         996.9237 (1.0)       1,069.4128 (1.0)       1,030.2856 (1.0)       28.9713 (1.0)      970.6046 (1.0)           5        1000
test_benchmark[decode-cy]        2,359.9832 (2.29)      2,193.5129 (2.20)      2,397.7169 (2.24)      2,335.8156 (2.27)      81.1284 (2.80)     428.1160 (0.44)          5        1000
test_benchmark[decode-mypy]      7,458.2955 (7.23)      7,416.7515 (7.44)      7,501.8866 (7.01)      7,458.9455 (7.24)      33.6325 (1.16)     134.0672 (0.14)          5         134
test_benchmark[decode-py]       20,846.8590 (20.20)    20,804.1810 (20.87)    21,317.2490 (19.93)    20,925.5638 (20.31)    220.1414 (7.60)      47.7884 (0.05)          5         100
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
```

### Encode

```
----------------------------------------------------------------- benchmark 'case=encode': 4 tests -----------------------------------------------------------------
Name (time in ms)                Median                Min                Max               Mean            StdDev                 OPS            Rounds  Iterations
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark[encode-abi3]      4.3793 (1.0)       4.3537 (1.0)       4.4703 (1.0)       4.3909 (1.0)      0.0456 (1.07)     227.7460 (1.0)           5        1000
test_benchmark[encode-mypy]      4.8230 (1.10)      4.7746 (1.10)      5.1901 (1.16)      4.9217 (1.12)     0.1754 (4.11)     203.1825 (0.89)          5         188
test_benchmark[encode-cy]        5.7844 (1.32)      5.7490 (1.32)      5.8548 (1.31)      5.7932 (1.32)     0.0427 (1.0)      172.6154 (0.76)          5         180
test_benchmark[encode-py]       13.5941 (3.10)     13.4517 (3.09)     13.6278 (3.05)     13.5731 (3.09)     0.0712 (1.67)      73.6751 (0.32)          5         100
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
```

(linux, python3.10, Intel G6405)

### Decode

```
----------------------------------------------------------------- benchmark 'case=decode': 4 tests -----------------------------------------------------------------
Name (time in ms)                Median                Min                Max               Mean            StdDev                 OPS            Rounds  Iterations
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark[decode-abi3]      1.6491 (1.0)       1.6286 (1.0)       1.7047 (1.0)       1.6624 (1.0)      0.0309 (1.0)      601.5413 (1.0)           5         123
test_benchmark[decode-cy]        2.8717 (1.74)      2.6863 (1.65)      3.2330 (1.90)      2.9332 (1.76)     0.2293 (7.42)     340.9274 (0.57)          5         100
test_benchmark[decode-mypy]     12.0145 (7.29)     11.5570 (7.10)     14.5340 (8.53)     12.5719 (7.56)     1.1936 (38.60)     79.5425 (0.13)          5          19
test_benchmark[decode-py]       35.0529 (21.26)    33.3535 (20.48)    38.7693 (22.74)    35.3535 (21.27)    2.1658 (70.05)     28.2857 (0.05)          5          10
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
```

### Encode

```
----------------------------------------------------------------- benchmark 'case=encode': 4 tests -----------------------------------------------------------------
Name (time in ms)                Median                Min                Max               Mean            StdDev                 OPS            Rounds  Iterations
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark[encode-abi3]      4.3259 (1.0)       4.1241 (1.0)       4.4975 (1.0)       4.3361 (1.0)      0.1493 (1.0)      230.6215 (1.0)           5         100
test_benchmark[encode-cy]        6.0694 (1.40)      5.9276 (1.44)      6.5716 (1.46)      6.1912 (1.43)     0.2888 (1.93)     161.5190 (0.70)          5         100
test_benchmark[encode-mypy]      7.0700 (1.63)      6.9248 (1.68)      7.6381 (1.70)      7.1601 (1.65)     0.2969 (1.99)     139.6629 (0.61)          5         100
test_benchmark[encode-py]       23.2005 (5.36)     22.7801 (5.52)     25.4143 (5.65)     23.7614 (5.48)     1.0881 (7.29)      42.0851 (0.18)          5          10
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
```
