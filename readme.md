# bencode-c

bencode serialize/deserialize written in native c extension.

```shell
pip install bencode-c
```

```python
import bencode_c

# NOTICE: we decode bencode bytes to bytes, not str.
assert bencode_c.bdecode(b'd5:hello5:worlde') == {b'hello': b'world'}

assert bencode_c.bencode(...) == b'...'
```

## Benchmark

this maybe the fastest bencode library in python.

compared packages:

- native c extension (this package): [bencode-c](https://pypi.org/project/bencode-c)
- pure python implement: [bencode-py](https://pypi.org/project/bencode-py)
- cython implement: [fast-bencode](https://pypi.org/project/fast-bencode)
- pure python implement with mypyc: [bencode2](https://pypi.org/project/bencode2)

test cases are 20 torrents from real world.

(windows, python3.10 AMD R7 5800X)

### Decode

```
---------------------------------------------------------------------------- benchmark: 4 tests ------------------------------------------------------------------
Name (time in ms)                   Min                Max               Mean            StdDev             Median               OPS            Rounds  Iterations
------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark[decode-abi3]      1.0225 (1.0)       1.0944 (1.0)       1.0579 (1.0)      0.0295 (1.0)       1.0603 (1.0)    945.2868 (1.0)           5        1000
test_benchmark[decode-cy]        2.2427 (2.19)      2.6889 (2.46)      2.5606 (2.42)     0.1833 (6.21)      2.6055 (2.46)   390.5276 (0.41)          5        1000
test_benchmark[decode-mypy]      7.3868 (7.22)      7.5272 (6.88)      7.4385 (7.03)     0.0525 (1.78)      7.4245 (7.00)   134.4351 (0.14)          5         136
test_benchmark[decode-py]       21.3710 (20.90)    23.5037 (21.48)    22.2669 (21.05)    1.0047 (34.03)    21.6753 (20.44)   44.9097 (0.05)          5         100
------------------------------------------------------------------------------------------------------------------------------------------------------------------
```

### Encode

```
---------------------------------------------------------------------------- benchmark: 4 tests ------------------------------------------------------------------
Name (time in ms)                   Min                Max               Mean            StdDev             Median               OPS            Rounds  Iterations
------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark[encode-abi3]      4.4794 (4.38)      4.7210 (4.31)      4.5929 (4.34)     0.0862 (2.92)      4.5843 (4.32)   217.7261 (0.23)          5        1000
test_benchmark[encode-mypy]      4.7666 (4.66)      5.1391 (4.70)      4.9445 (4.67)     0.1576 (5.34)      4.9069 (4.63)   202.2461 (0.21)          5         203
test_benchmark[encode-cy]        6.1181 (5.98)      6.6827 (6.11)      6.4486 (6.10)     0.2385 (8.08)      6.4660 (6.10)   155.0733 (0.16)          5         167
test_benchmark[encode-py]       13.4574 (13.16)    14.1674 (12.95)    13.7818 (13.03)    0.2926 (9.91)     13.6739 (12.90)   72.5593 (0.08)          5         100
------------------------------------------------------------------------------------------------------------------------------------------------------------------
```

(linux, python3.10, Intel G6405)

### Decode

```
----------------------------------------------------------------- benchmark 'case=decode': 4 tests -----------------------------------------------------------------
Name (time in ms)                Median                Min                Max               Mean            StdDev                 OPS            Rounds  Iterations
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark[decode-abi3]      1.6491 (1.0)       1.6286 (1.0)       1.7047 (1.0)       1.6624 (1.0)      0.0309 (1.0)      601.5413 (1.0)           5         123
test_benchmark[decode-cy]        2.8717 (1.74)      2.6863 (1.65)      3.2330 (1.90)      2.9332 (1.76)     0.2293 (7.42)     340.9274 (0.57)          5         100
test_benchmark[decode-mypy]     12.0145 (7.29)     11.5570 (7.10)     14.5340 (8.53)     12.5719 (7.56)     1.1936 (38.60)     79.5425 (0.13)          5          19
test_benchmark[decode-py]       35.0529 (21.26)    33.3535 (20.48)    38.7693 (22.74)    35.3535 (21.27)    2.1658 (70.05)     28.2857 (0.05)          5          10
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
```

### Encode

```
----------------------------------------------------------------- benchmark 'case=encode': 4 tests -----------------------------------------------------------------
Name (time in ms)                Median                Min                Max               Mean            StdDev                 OPS            Rounds  Iterations
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark[encode-abi3]      4.3259 (1.0)       4.1241 (1.0)       4.4975 (1.0)       4.3361 (1.0)      0.1493 (1.0)      230.6215 (1.0)           5         100
test_benchmark[encode-cy]        6.0694 (1.40)      5.9276 (1.44)      6.5716 (1.46)      6.1912 (1.43)     0.2888 (1.93)     161.5190 (0.70)          5         100
test_benchmark[encode-mypy]      7.0700 (1.63)      6.9248 (1.68)      7.6381 (1.70)      7.1601 (1.65)     0.2969 (1.99)     139.6629 (0.61)          5         100
test_benchmark[encode-py]       23.2005 (5.36)     22.7801 (5.52)     25.4143 (5.65)     23.7614 (5.48)     1.0881 (7.29)      42.0851 (0.18)          5          10
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
```
